name: Update @remix-run/dev

on:
  workflow_dispatch:
    inputs:
      new-version:
        type: string
        description: 'Optional version to update @remix-run/dev to inside of @vercel/remix-builder'

jobs:
  update-remix-run-dev:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup node
        uses: actions/setup-node@v4
        with:
          node-version: 16

      - name: Enable corepack
        run: corepack enable pnpm

      # --- START OF MOCK STEP ---
      - name: Setup Mock Files
        run: |
          mkdir -p packages/remix
          echo '{"version": "0.0.0", "dependencies": {"@remix-run/dev": "0.0.0"}}' > packages/remix/package.json
          echo "Mock package.json created at packages/remix/package.json"
      # --- END OF MOCK STEP ---

      - name: Update @remix-run/dev
        uses: actions/github-script@v7
        env:
          # This ensures the script has A token to look at, even if it's not the Vercel one.
          GH_TOKEN_PULL_REQUESTS: ${{ secrets.GITHUB_TOKEN }} 
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const script = require('./utils/update-remix-run-dev.js')
            await script({ github, context }, "${{ inputs.new-version }}")
